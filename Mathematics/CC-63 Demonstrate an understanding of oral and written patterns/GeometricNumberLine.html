<!doctype html>
<html>
<head>
    <title>D3 tutorial</title>
     <style>    .heavy { font: bold 15px sans-serif; }  </style>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js" charset="utf-8"></script>
</head>
<body>

<form id="frm1_ratio" action="/action_page.php">
    Enter the <b>common ratio</b> for the geometric sequence:
    <input type="number" name="quantity" value="3" min="1" max="5">
</form>
    
<form id="frm2_init" action="/action_page.php">
    Enter the <b>inital value</b> for the geometric sequence:
    <input type="number" name="quantity" value="1" min="0" max="50">
</form>
    
<svg width="1000" height="120">
    <line x1="0" y1="50" x2="1000" y2="50" stroke="black"/>
    <rect x="0" y="30" width="2" height="40" fill="black"/>
    <text x="0" y="85" fill="black">0</text>
</svg>
<script>
        var svg = d3.select('svg');

        var numberline = [...Array(5).keys()];


        d3.select("body").append("button")
                .text("Plot the sequence")
                .on("click", function(){
        
                    initValue = parseInt(document.getElementById("frm2_init")
                                 .elements[0]
                                 .value);
            
                    ratio = parseInt(document.getElementById("frm1_ratio")
                                 .elements[0]
                                 .value);
                    
                    var data = [initValue]
                    
                    if(ratio){
                        
                        var data = [...Array(50).keys()]
                            .map( (num,i) => initValue*(ratio**i))
                            .filter(num => num < 50);
                    }

            
                    console.log(data);
            
                    svg.selectAll('circle').remove();
                    svg.selectAll('text').remove();
                    svg.append('text')
                       .text(0)
                       .attr('x',0)
                       .attr('y',85)
                       .fill("black")
            
                    let points = svg.selectAll('points')
                        .data(eval(data))
                        .enter()
                        .append('circle')
                        .classed('points', true)
                        .attr('r', 10)
                        .attr('fill', 'green')
                        .attr('cx', 30)
                        .attr('cy', 20)
                        .transition()
                            .delay(function(d,i){return 5*i})
                            .duration(function(d,i){return 200*(i+1)})
                            .attr('cx', function(d) { return d*20; })
                            .attr('cy', 50)
                    
                    let text = svg.selectAll('.indicies')
                               .data(eval(data))
                               .enter()
                               .append('text')                        
                               .classed('indicies', true)
                               .attr("fill", "white")
                               .text(d => d)
                               .attr('x', function(d) { return d*20; })
                               .attr('y', 50)
                               .attr('text-anchor',"middle")
                               .attr('alignment-baseline',"central")
                               .attr('class',"heavy")
                               .transition()
                                    .delay(function(d,i){return 5*i})
                                    .duration(function(d,i){return 200*(i+1)})
                                    .attr("fill", "black")
                    });


</script>
</body>
</html>